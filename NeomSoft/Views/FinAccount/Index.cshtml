@model IEnumerable<NeomSoft.Logic.ViewModels.FinAccountViewModel>

@{
    ViewBag.Title = "بيانات الحسابات";
}

<h2>بيانات الحسابات</h2>
<br />
<div>
    <div class="form-group col-sm-4">
        <div class="input-group" style="max-width: 300px;">
            <input class="form-control" id="searchInput" name="searchBtn" type="text" />
            <div class="input-group-addon" style="padding:0;">
                <button class="btn btn-primary" id="searchBtn" type="button" style="width:50px"> <i class="glyphicon glyphicon-search"></i> </button>
            </div>
        </div>
    </div>
    <div class="form-group col-sm-8">
        <a class="btn btn-primary" href="@Url.Content("~/FinAccount/CreateAccount")"> إضافة حساب جديد <i class="glyphicon glyphicon-plus"></i> </a>
    </div>

</div>
<table id="acctsTable" class="table table-bordered table-hover table-striped">
    <tr>

        <th>
            رقم الحساب
        </th>
        <th>
            اسم الحساب
        </th>
        <th>
            الحساب الأب
        </th>
        <th>
            ملاحظة
        </th>
        <th>
            تاريخ الإضافة
        </th>
        <th>
            أضيف بواسطة
        </th>

        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Code)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.NameAr)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ParentAccountName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Note)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.AddedDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.AddedBy)
            </td>

            <td>

                <button class="btn btn-primary btn-sm viewAccountData" data-id="@item.AccountID"> عرض <i class="glyphicon glyphicon-eye-open"></i> </button>
                <a class="btn btn-warning btn-sm" href="@Url.Content("~/FinAccount/EditAccount")?id=@item.AccountID"> تعديل <i class="glyphicon glyphicon-pencil"></i> </a>
                <a class="btn btn-danger btn-sm" href="@Url.Content("~/FinAccount/DeleteAccount")?id=@item.AccountID"> حذف <i class="glyphicon glyphicon-trash"></i> </a>
                <button type='button' class="btn btn-default btn-sm printAcct" data-id="@item.AccountID"> طباعة <i class="glyphicon glyphicon-print"></i></button>
            </td>
        </tr>
    }

</table>
<div>
    <button type='button' class="btn btn-primary" onclick='$("#acctsTable").printElement({ keepHide: ["td .btn"] });'> طباعة النتائج <i class="glyphicon glyphicon-print"></i></button>
</div>



<!-- Modal -->
<div class="modal fade" id="accountModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">بيانات حساب</h4>
            </div>
            <div class="modal-body" id="accountModalBody">
                حاري التحميل ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">إغلاق</button>
                <button type='button' class="btn btn-primary" onclick='$("#accountModal").printElement({ keepHide: [".modal-footer",".modal-header button"] });'> طباعة <i class="glyphicon glyphicon-print"></i></button>
            </div>
        </div>

    </div>
</div>

@section Scripts
{
    <script src="~/Scripts/divjs.js"></script>
    <script>
        $(function () {
            $('.viewAccountData').click(function () {
                debugger;
                $.ajax({
                    type: "GET",
                    url: '@Url.Content("~/FinAccount/AccountData")?id=' + $(this).data('id'),
                    contentType: "application/json; charset=utf-8",
                    dataType: "html",
                    success: function (response) {
                        $("#accountModal").modal({ show: true });
                        $("#accountModalBody").html(response);
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });

            });

            $('.printAcct').click(function () {
                $.get('@Url.Content("~/FinAccount/AccountData")?id=' + $(this).data('id')).done(function (result) {
                    $("#accountModal").modal({ show: true });
                    $("#accountModalBody").html(result);
                    setTimeout(function () {
                        $("#accountModal").printElement({ keepHide: [".modal-footer", ".modal-header button"] });
                        $("#accountModal").modal("hide");
                    }, 500);
                    
                });


            });

            $.urlParam = function (name) {
                var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
                if (results == null) {
                    return null;
                }
                else {
                    return decodeURI(results[1]);
                }
            }

            var s = $.urlParam('searchText');
            $('#searchInput').val(s);

            $('#searchBtn').click(function () {
                search();
            });

            $('#searchInput').keyup(function (e) {
                if (e.keyCode == 13) {
                    search();
                }
            });

            function search() {
                window.location.href = window.location.origin + window.location.pathname + "?searchText=" + $('#searchInput').val();
            }

        });

    </script>
}
